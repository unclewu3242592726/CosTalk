# CosTalk 端到端测试指南

## 🎯 测试目标

验证完整的语音对话流程：**语音录制 → ASR识别 → LLM对话 → TTS合成 → 音频播放**

## 🚀 快速启动

### 1. 启动后端服务

```bash
cd backend
chmod +x start.sh
./start.sh
```

或者直接运行：
```bash
cd backend
go run costalk.go
```

### 2. 启动前端服务

```bash
cd frontend
python3 -m http.server 3000
```

### 3. 打开测试页面

在浏览器中访问：`http://localhost:3000/test.html`

## 🧪 测试步骤

### 步骤 1: 连接测试
1. 打开测试页面
2. 确认WebSocket地址为：`ws://localhost:8888/v1/chat/stream`
3. 点击 **"🔗 连接"** 按钮
4. 状态应显示为 **"已连接"**

### 步骤 2: 配置验证
确认以下配置：
- **LLM 提供商**: 七牛云 LLM
- **ASR 提供商**: 七牛云 ASR  
- **TTS 提供商**: 七牛云 TTS
- **语音音色**: 甜美女声
- **语速**: 1.0

### 步骤 3: 语音对话测试
1. 点击 **"🎤 开始录音"** 按钮
2. 对着麦克风说话（例如："你好，请介绍一下自己"）
3. 点击 **"⏹️ 停止录音"** 按钮
4. 观察处理流程：

```
🎤 音频录制 → 📤 发送到ASR → 🤖 LLM处理 → 🔊 TTS合成 → 🎵 音频播放
```

## ✅ 预期结果

### 成功流程：
1. **ASR识别**: 在对话历史中看到 `🎤 [您说的话]`
2. **LLM回复**: 在对话历史中看到 `🤖 [AI回复]`
3. **TTS播放**: 自动播放AI回复的语音
4. **日志输出**: 系统日志显示各个步骤的处理状态

### 日志示例：
```
[时间] WebSocket 连接成功
[时间] 已发送配置信息
[时间] 开始录音...
[时间] 录音结束
[时间] 音频数据已发送
[时间] ASR识别: 你好，请介绍一下自己
[时间] LLM回复: 您好！我是CosTalk智能语音助手...
[时间] 收到TTS音频数据
[时间] 开始播放TTS音频
```

## 🔧 故障排除

### 问题 1: WebSocket 连接失败
- 确认后端服务已启动
- 检查端口8888是否被占用
- 查看后端日志输出

### 问题 2: 录音权限被拒绝
- 确保浏览器允许麦克风访问
- 使用 HTTPS 或 localhost 访问
- 检查浏览器设置

### 问题 3: ASR识别失败
- 确认七牛云API密钥配置正确
- 检查网络连接
- 查看后端错误日志

### 问题 4: TTS音频不播放
- 检查浏览器音频权限
- 确认音频格式支持
- 查看控制台错误信息

## 📊 性能指标

### 正常指标：
- **WebSocket连接**: < 1秒
- **ASR识别延迟**: 1-3秒  
- **LLM响应时间**: 2-5秒
- **TTS合成**: 1-2秒
- **总体响应**: 5-10秒

## 🔍 调试技巧

### 1. 浏览器开发者工具
- 打开F12查看控制台日志
- 检查Network标签页的WebSocket连接
- 查看错误信息和网络请求

### 2. 后端日志
```bash
# 查看详细日志
go run costalk.go -f etc/costalk-api.yaml -v
```

### 3. 测试简化流程
- 先测试WebSocket连接
- 再测试JSON消息发送
- 最后测试音频流程

## 🎉 测试成功标志

✅ WebSocket连接成功建立  
✅ 配置信息正确发送  
✅ 音频录制和发送正常  
✅ ASR识别结果正确显示  
✅ LLM回复内容合理  
✅ TTS音频正常播放  
✅ 整个对话流程流畅无卡顿  

## 📝 测试报告

测试完成后，请记录：
- 测试时间和环境
- 各个环节的响应时间
- 发现的问题和解决方案
- 系统稳定性评估

---

**🎊 恭喜！如果所有步骤都成功，说明CosTalk语音对话系统已经完全可用！**